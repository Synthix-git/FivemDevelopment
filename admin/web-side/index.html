<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>syn_clipboard</title>
  <meta http-equiv="Cache-Control" content="no-store" />
  <style>html,body{background:transparent;}</style>
</head>
<body>
<script>
(function(){
  // Fallback seguro para copiar sem gesto do utilizador:
  function legacyCopy(text){
    try{
      const ta = document.createElement('textarea');
      ta.value = text;
      ta.setAttribute('readonly','');
      ta.style.position = 'absolute';
      ta.style.left = '-9999px';
      document.body.appendChild(ta);
      ta.select();
      const ok = document.execCommand('copy');
      document.body.removeChild(ta);
      return ok;
    }catch(e){
      return false;
    }
  }

  async function modernCopy(text){
    try{
      if (navigator.clipboard && navigator.clipboard.writeText){
        await navigator.clipboard.writeText(text);
        return true;
      }
      return legacyCopy(text);
    }catch(e){
      return legacyCopy(text);
    }
  }

  window.addEventListener('message', async (event)=>{
    const data = event.data || {};
    if (data.action === 'copy' && typeof data.text === 'string'){
      const ok = await modernCopy(data.text);
      // Responder ao client.lua
      try{
        fetch(`https://${GetParentResourceName()}/copied`, {
          method: 'POST',
          headers: {'Content-Type':'application/json; charset=UTF-8'},
          body: JSON.stringify({ ok, text: data.text })
        });
      }catch(e){}
    }
  });
})();
</script>
</body>
</html>
